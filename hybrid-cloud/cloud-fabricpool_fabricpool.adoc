---
sidebar: sidebar 
permalink: hybrid-cloud/cloud-fabricpool_fabricpool.html 
keywords: flexpod, cloud, fabricpool, overview, hybrid, storage, solution sdd, performance 
summary: FabricPool 是 ONTAP 中的一种混合存储解决方案，它使用全闪存（ SSD ）聚合作为性能层，并将公有云服务中的对象存储作为云层。根据数据是否经常访问，此配置可以基于策略移动数据。 
---
= FabricPool
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/




== FabricPool 概述

FabricPool 是 ONTAP 中的一种混合存储解决方案，它使用全闪存（ SSD ）聚合作为性能层，并将公有云服务中的对象存储作为云层。根据数据是否经常访问，此配置可以基于策略移动数据。ONTAP 平台上的 AFF 和纯 SSD 聚合在 FabricPool 中均支持 FAS 。数据处理在块级别执行，全闪存性能层中经常访问的数据块标记为热块，不常访问的数据块标记为冷块。

使用 FabricPool 有助于降低存储成本，而不会影响性能，效率，安全性或保护。FabricPool 对企业级应用程序是透明的，它可以降低存储 TCO ，而无需重新构建应用程序基础架构，从而充分利用云效率。

FlexPod 可以从 FabricPool 的存储分层功能中受益，从而更高效地利用 ONTAP 闪存存储。非活动虚拟机（ VM ），不常用的 VM 模板以及 NetApp SnapCenter for vSphere 中的 VM 备份可能会占用数据存储库卷中的宝贵空间。将冷数据移至云层可为 FlexPod 基础架构上托管的高性能任务关键型应用程序释放空间和资源。


NOTE: 光纤通道和 iSCSI 协议通常需要较长的时间才能发生超时（ 60 到 120 秒），但它们不会像 NAS 协议那样重试建立连接。如果 SAN 协议超时，则必须重新启动应用程序。即使是短暂的中断，也可能对使用 SAN 协议的生产应用程序造成灾难性的后果，因为无法保证与公有云的连接。为了避免这种问题描述， NetApp 建议在对 SAN 协议访问的数据进行分层时使用私有云。

在 ONTAP 9.6 中， FabricPool 与所有主要公有云提供商相集成：阿里云对象存储服务， Amazon AWS S3 ， Google 云存储， IBM 云对象存储和 Microsoft Azure Blob 存储。本报告重点介绍了 Amazon AWS S3 存储作为云对象层的选择。



== 复合聚合

通过将 ONTAP 闪存聚合与云对象存储（例如 AWS S3 存储分段）关联来创建 FabricPool 实例，以创建复合聚合。在复合聚合中创建卷时，它们可以利用 FabricPool 的分层功能。将数据写入卷时， ONTAP 会为每个数据块分配一个温度。首次写入块时，会为其分配温度为 " 热 " 。随着时间的推移，如果不访问数据，则会经历一个冷却过程，直到最终将其分配为冷状态为止。然后，这些不常访问的数据块将从性能 SSD 聚合分层到云对象存储。

ONTAP 中的卷分层策略会修改块从指定为冷存储到移动到云对象存储这段时间。通过修改 ONTAP 设置，控制块变冷所需的天数，可以进一步细化。数据分层的候选对象包括传统卷快照，适用于 vSphere 的 SnapCenter VM 备份和其他基于 NetApp Snapshot 的备份，以及 vSphere 数据存储库中任何不常用的块，例如 VM 模板和不常访问的 VM 数据。



=== 非活动数据报告

ONTAP 中提供了非活动数据报告（ IDR ）功能，用于帮助评估可从聚合分层的冷数据量。默认情况下， ONTAP 9.6 会启用 IDR ，并使用默认的 31 天散热策略来确定卷中的哪些数据处于非活动状态。


NOTE: 分层的冷数据量取决于卷上设置的分层策略。此数量可能与 IDR 使用默认 31 天冷却期检测到的冷数据量不同。



== 对象创建和数据移动

FabricPool 可在 NetApp WAFL 块级别运行，并可运行散热块，将这些块串联到存储对象中，然后将这些对象迁移到云层。每个 FabricPool 对象均为 4 MB ，由 1 ， 024 个 4 KB 块组成。根据领先云提供商的性能建议，对象大小固定为 4 MB ，不能更改。如果读取冷块并使其变热，则只会提取 4 MB 对象中请求的块并将其移回性能层。整个对象和整个文件都不会迁移回。仅迁移必要的块。


NOTE: 如果 ONTAP 检测到顺序读取的机会，则会在读取数据块之前从云层请求数据块以提高性能。

默认情况下，只有在性能聚合利用率超过 50% 时，才会将数据移至云层。可以将此阈值设置为较低的百分比，以便将性能闪存层上的少量数据存储移至云。如果分层策略是仅在聚合接近容量时移动冷数据，则这可能很有用。

如果性能层利用率超过 70% 的容量，则冷数据将直接从云层读取，而不会回写到性能层。通过防止对使用率较高的聚合执行冷数据回写， FabricPool 可保留聚合以用于活动数据。



== 回收性能层空间

如前文所述， FabricPool 的主要使用情形是帮助最高效地使用高性能内部闪存存储。FlexPod 虚拟基础架构的卷快照和 VM 备份形式的冷数据可能会占用大量昂贵的闪存存储。通过实施以下两种分层策略之一，可以释放有价值的性能层存储：仅快照或自动。



=== 仅 Snapshot 分层策略

下图所示的仅 Snapshot 分层策略将占用空间但未与活动文件系统共享块的 VM 的冷卷快照数据和 SnapCenter for vSphere 备份移动到云对象存储中。仅 Snapshot 分层策略会将冷数据块移至云层。如果需要还原，则云中的冷块会变热并移回内部的性能闪存层。

image:cloud-fabricpool_image4.png["错误：缺少图形映像"]



=== 自动分层策略

下图所示的 FabricPool 自动分层策略不仅会将冷快照数据块移至云，还会移动活动文件系统中的任何冷块。这可能包括 VM 模板以及数据存储库卷中未使用的任何 VM 数据。移动哪些冷块由卷的 `tiering-minimum-cooling-days` 设置控制。如果应用程序随机读取云层中的冷块，则这些块会变热并恢复到性能层。但是，如果冷块通过防病毒扫描程序等顺序进程读取，则这些块将保持冷状态并保留在云对象存储中；它们不会移回性能层。

使用自动分层策略时，不常访问的热块将以云连接的速度从云层中回滚。如果应用程序对延迟敏感，则可能会影响虚拟机性能，在对数据存储库使用自动分层策略之前，应考虑这一点。NetApp 建议将集群间 LIF 放置在速度为 10GbE 的端口上，以获得足够的性能。


NOTE: 在将对象存储附加到 FabricPool 聚合之前，应使用对象存储配置器测试该对象存储的延迟和吞吐量。

image:cloud-fabricpool_image5.png["错误：缺少图形映像"]



=== 所有分层策略

与 " 自动 " 和 " 仅 Snapshot " 策略不同，所有分层策略会将整个数据卷立即移动到云层。此策略最适合二级数据保护或归档卷，对于这些卷，数据必须出于历史或法规目的进行保留，但很少被访问。不建议对 VMware 数据存储库卷使用 all 策略，因为写入数据存储库的任何数据都会立即移至云层。后续读取操作将从云执行，可能会给驻留在数据存储库卷中的 VM 和应用程序带来性能问题。



== 安全性

安全性是云和 FabricPool 关注的核心问题。性能层支持 ONTAP 的所有原生安全功能，在将数据传输到云层时，数据移动也会受到保护。FabricPool 使用 https://tools.ietf.org/html/rfc5288["AES-256-GCM"^] 在性能层上使用加密算法，并将此加密端到云层进行维护。移动到云对象存储的数据块通过传输层安全（ Transport Layer Security ， TLS ） v1.2 进行保护，以保持存储层之间的数据机密性和完整性。


NOTE: 支持通过未加密连接与云对象存储进行通信，但 NetApp 不建议这样做。



=== 数据加密

数据加密对于保护知识产权，贸易信息和个人身份客户信息至关重要。FabricPool 完全支持 NetApp 卷加密（ NetApp Volume Encryption ， NVE ）和 NetApp 存储加密（ NetApp Storage Encryption ， NSE ），以维护现有数据保护策略。将性能层上的所有加密数据移动到云层时，这些数据仍保持加密状态。客户端加密密钥归 ONTAP 所有，服务器端对象存储加密密钥归相应的云对象存储所有。未使用 NVE 加密的任何数据都将使用 AES-256-GCM 算法进行加密。不支持其他 AES-256 密码。


NOTE: 使用 NSE 或 NVE 是可选的，使用 FabricPool 不需要。
